{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
{% block content %}
<div class="container mt-3" style="width:30%">
  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active text-muted" id="follwing-tab" data-bs-toggle="tab" data-bs-target="#follwing" type="button" role="tab" aria-controls="follwing" aria-selected="false">
        íŒ”ë¡œì‰ ëª©ë¡ <span class="badge text-bg-secondary">{{ user.follow.count }}ëª…</span>
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link text-muted" id="follower-tab" data-bs-toggle="tab" data-bs-target="#follower" type="button" role="tab" aria-controls="follower" aria-selected="true">
        íŒ”ë¡œì›Œ ëª©ë¡ <span class="badge text-bg-secondary">{{ user.followers.count }}ëª…</span>
      </button>
    </li>
  </ul>
  <div class="tab-content mt-3" id="myTabContent">
    <div class="tab-pane fade show active" id="follwing" role="tabpanel" aria-labelledby="follwing-tab">
      {% if user.follow.count != 0 %}
        {% for following in followings %}
          <div class="d-flex justify-content-between">
              <div class="mb-3">
                <a class="text-dark" href="{% url 'accounts:detail' following.pk %}" style="text-decoration: none;">
                  {% if following.profile %}
                    <img class='rounded-circle' style='height:50px;width:50px;' src="{{ following.profile.url }}" alt="{{ user.profile }}">
                  {% else %}
                    <img class='rounded-circle' style='height:50px;width:50px;' src="{% static '/images/profile/user.png'%}" alt="user">
                  {% endif %}
                  <span class="fs-5">{{ following.username }}</span>
                </a>
              </div>           
            <form id='follow-form' data-user-id="{{ following.pk }}" method='POST'>
              {% csrf_token %}
              <input type="submit" value="ì‚­ì œ" class='btn btn-sm signup_btn fw-bold'>
            </form>
          </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="text-muted text-center">
          ì•—!ğŸ˜ íŒ”ë¡œì‰í•œ ì‚¬ìš©ìê°€ ì—†ì–´ìš”.
        </div>
      {% endif %}
    </div>

    <div class="tab-pane fade" id="follower" role="tabpanel" aria-labelledby="follower-tab">
      {% if user.followers.count != 0 %}
        {% for follower in followers %}
          <div class="d-flex justify-content-between">
            <div class="mb-3">
              <a class="text-dark" href="{% url 'accounts:detail' follower.pk %}" style="text-decoration: none;">
                {% if follower.profile %}
                  <img class='rounded-circle' style='height:50px;width:50px;' src="{{ follower.profile.url }}" alt="{{ user.profile }}">
                {% else %}
                  <img class='rounded-circle' style='height:50px;width:50px;' src="{% static '/images/profile/user.png'%}" alt="user">
                {% endif %}
                <span class="fs-5">{{ follower.username }}</span>
              </a>
            </div>
            <form id='follow-form' data-user-id="{{ user.pk }}" method='POST'>
              {% csrf_token %}
              <input type="submit" value="ì‚­ì œ" class='btn btn-sm signup_btn fw-bold'>
            </form>
            </div>
        {% endfor %}
      {% else %}
        <div class="text-muted text-center">
          ì•—!ğŸ˜ íŒ”ë¡œì›Œí•œ ì‚¬ìš©ìê°€ ì—†ì–´ìš”.
        </div>
      {% endif %}
    </div>

  </div>
</div>
{% endblock content %}

{% comment %} {% block script %}
<script>
const form = document.querySelector('#follow-form')
const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value

form.addEventListener('submit', function (event) {
  event.preventDefault()
  const userId = event.target.dataset.userId

  axios({
    method: 'post',
    url: `/accounts/${userId}/followers/`,
    headers: {
      'X-CSRFToken': csrftoken
    }
  })
  .then((response) => {
    const isFollowed = response.data.is_followed
    const followBtn = document.querySelector('#follow-form > input[type=submit]')
    if (isFollowed === true) {
      followBtn.value = 'ì´ ì‚¬ìš©ìë¥¼ UnFollow í•˜ê² ì–´ìš”.';
      followBtn.classList.add('login_btn');
      followBtn.classList.remove('signup_btn');
    } else {
      followBtn.value = 'ì´ ì‚¬ìš©ìë¥¼ Follow í• ë˜ìš”!';
      followBtn.classList.add('signup_btn');
      followBtn.classList.remove('login_btn');
    }

    const followersCountTag = document.querySelector('#followings-count')
    const followingsCountTag = document.querySelector('#followers-count')
    const followersCount = response.data.followers_count
    const followingsCount = response.data.followings_count
    followersCountTag.innerText = followersCount
    followingsCountTag.innerText = followingsCount
  })
  .catch((error) => {
    console.log(error.response)
  })
})
</script>
{% endblock script %} {% endcomment %}